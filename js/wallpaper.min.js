//HEADER====================================================================================
// Раскрываем - закрываем бургер============
document.addEventListener('click', function (e) {
	let burger = document.querySelector('.icon-menu');
	let menu = document.querySelector('.menu');
	let plashMask = document.querySelector('.backgroundMask');
	let body = document.querySelector('body');
	// закрываем на фон
	if (e.target.classList.contains('backgroundMask')) {
		burger.classList.remove('_active');
		menu.classList.remove('_active');
		body.classList.remove('_lock');
		plashMask.style = 'display: none;';
	}
	// закрываем на крестик
	if (e.target.closest('.icon-menu-active')) {
		burger.classList.remove('_active');
		menu.classList.remove('_active');
		body.classList.remove('_lock');
		plashMask.style = 'display: none;'
	}

	// открываем бургер
	if (e.target.closest('.icon-menu')) {
		burger.classList.toggle('_active');
		menu.classList.toggle('_active');
		body.classList.add('_lock');
		plashMask.style = 'display: block;'
	}
});

// ==================================

// Функции START ========================================================
let deleteActiveTabAndBody = () => {
	let tabPage = document.querySelectorAll('.tab-page');
	let tabMore = document.querySelectorAll('.tab-more');
	let bodyPage = document.querySelectorAll('.calc-count');
	let inpBlockPage = document.querySelectorAll('.inp-block_change');
	tabPage.forEach((elem) => {
		if (elem.classList.contains('_active')) {
			elem.classList.remove('_active')
		}
	});
	tabMore.forEach((elem) => {
		if (elem.classList.contains('_active')) {
			elem.classList.remove('_active')
		}
	});
	bodyPage.forEach((elem) => {
		if (elem.classList.contains('_active')) {
			elem.classList.remove('_active')
		}
	});
	inpBlockPage.forEach((elem) => {
		if (elem.classList.contains('_active')) {
			elem.classList.remove('_active')
		}
	});
}

radioDel = (e) => {
	let radioBody = e.target.parentNode.parentNode.parentNode;
	let allRadio = radioBody.querySelectorAll('.radio__text');
	allRadio.forEach((elem) => {
		if (elem.classList.contains('_active')) {
			elem.classList.remove('_active')
		}
	});
}

let addRoom = () => {
	deleteActiveTabAndBody()
	let roomTab = document.querySelector('#room-tab');
	let roomBody = document.querySelector('#room-body');
	let roomBlock = document.querySelector('#room-block');
	roomTab.classList.add('_active');
	roomBody.classList.add('_active');
	roomBlock.classList.add('_active');
}
let addWall = () => {
	deleteActiveTabAndBody()
	let wallTab = document.querySelector('#wall-tab');
	let wallBody = document.querySelector('#room-body');
	let wallBlock = document.querySelector('#wall-block');
	wallTab.classList.add('_active');
	wallBlock.classList.add('_active');
	wallBody.classList.add('_active');
}

let addDetails = () => {
	deleteActiveTabAndBody()
	let detailsTab = document.querySelector('#details-tab');
	let detailsBody = document.querySelector('#details-body');
	detailsTab.classList.add('_active');
	detailsBody.classList.add('_active');
}
let addInstruction = () => {
	deleteActiveTabAndBody()
	let instructionTab = document.querySelector('#instruction-tab');
	let instructionBody = document.querySelector('#instruction-body');
	instructionTab.classList.add('_active');
	instructionBody.classList.add('_active');
}

let addOrDelSectionBlock = (e, addOrDel) => {
	let sectionBody = e.target.parentNode.parentNode.parentNode;
	let sectionContainer = sectionBody.querySelector('.inp-block__items');
	let sectionItem = sectionBody.querySelectorAll('.inp-item');
	let sectionItemLength = sectionItem.length + 1;
	if (addOrDel) {
		if (sectionBody.id === 'room-block') {
			sectionContainer.insertAdjacentHTML(
				'beforeend',
				`<div class="inp-block__item inp-item">
			<div class="inp-item__header">
				<div class="inp-item__title">Комната <span class="inp-item__title-num">${sectionItemLength}</span></div>
				<div class="_icon-del inp-item__rotate-del"></div>
			</div>
			<div class="inp-item__body">
				<div class="inp-item__inp-row">
					<div class="inp-item__name">Ширина</div>
					<input class="inp-item__input" id="room_1-width" autocomplete="off"
						type="number" name="room" data-error="Ошибка" data-value=""
						placeholder="5.18">
					<div class="inp-item__unit">м</div>
				</div>
				<div class="inp-item__inp-row">
					<div class="inp-item__name">Длина</div>
					<input class="inp-item__input" id="room_1-length" autocomplete="off"
						type="number" name="room" data-error="Ошибка" data-value=""
						placeholder="5.18">
					<div class="inp-item__unit">м</div>
				</div>
				<div class="inp-item__inp-row">
					<div class="inp-item__name">Высота</div>
					<input class="inp-item__input" id="room_1-height" autocomplete="off"
						type="number" name="room" data-error="Ошибка" data-value=""
						placeholder="5.18">
					<div class="inp-item__unit">м</div>
				</div>
			</div>
		</div>`);
		}
		if (sectionBody.id === 'wall-block') {
			sectionContainer.insertAdjacentHTML(
				'beforeend',
				`<div class="inp-block__item inp-item">
				<div class="inp-item__header">
					<div class="inp-item__title">Стена <span class="inp-item__title-num">${sectionItemLength}</span></div>
					<div class="_icon-del inp-item__rotate-del"></div>
				</div>
				<div class="inp-item__body">
					<div class="inp-item__inp-row">
						<div class="inp-item__name">Ширина</div>
						<input class="inp-item__input" id="wall_1-width" autocomplete="off"
							type="number" name="wall" data-error="Ошибка" data-value=""
							placeholder="5.18">
						<div class="inp-item__unit">м</div>
					</div>
					<div class="inp-item__inp-row">
						<div class="inp-item__name">Высота</div>
						<input class="inp-item__input" id="wall_1-height" autocomplete="off"
							type="number" name="wall" data-error="Ошибка" data-value=""
							placeholder="5.18">
						<div class="inp-item__unit">м</div>
					</div>
				</div>
			</div>`);
		}
		if (sectionBody.id === 'window-block') {
			sectionContainer.insertAdjacentHTML(
				'beforeend',
				`<div class="inp-block__item inp-item">
				<div class="inp-item__header">
					<div class="inp-item__title">Окно <span class="inp-item__title-num">${sectionItemLength}</span>
					</div>
					<div class="_icon-del inp-item__rotate-del"></div>
				</div>
				<div class="inp-item__body">
					<div class="inp-item__inp-row">
						<div class="inp-item__name">Ширина</div>
						<input class="inp-item__input" id="wondow_1-width" autocomplete="off"
							type="number" name="window" data-error="Ошибка" data-value=""
							placeholder="5.18">
						<div class="inp-item__unit">м</div>
					</div>
					<div class="inp-item__inp-row">
						<div class="inp-item__name">Длина</div>
						<input class="inp-item__input" id="window_1-length" autocomplete="off"
							type="number" name="window" data-error="Ошибка" data-value=""
							placeholder="5.18">
						<div class="inp-item__unit">м</div>
					</div>
					<div class="inp-item__inp-row inp-item__inp-row_num">
						<div class="inp-item__name inp-item__name_num">Колличество</div>
						<input class="inp-item__input inp-item__input_num" id="window_1-num"
							autocomplete="off" type="number" name="window" data-error="Ошибка"
							data-value="" placeholder="1">
						<div class="inp-item__unit inp-item__unit_num">шт.</div>
					</div>
				</div>
			</div>`);
		}
		if (sectionBody.id === 'door-block') {
			sectionContainer.insertAdjacentHTML(
				'beforeend',
				`<div class="inp-block__item inp-item">
				<div class="inp-item__header">
					<div class="inp-item__title">Дверь <span class="inp-item__title-num">${sectionItemLength}</span>
					</div>
					<div class="_icon-del inp-item__rotate-del"></div>
				</div>
				<div class="inp-item__body">
					<div class="inp-item__inp-row">
						<div class="inp-item__name">Ширина</div>
						<input class="inp-item__input" id="door_1-width" autocomplete="off"
							type="number" name="door" data-error="Ошибка" data-value=""
							placeholder="5.18">
						<div class="inp-item__unit">м</div>
					</div>
					<div class="inp-item__inp-row">
						<div class="inp-item__name">Длина</div>
						<input class="inp-item__input" id="door_1-length" autocomplete="off"
							type="number" name="door" data-error="Ошибка" data-value=""
							placeholder="5.18">
						<div class="inp-item__unit">м</div>
					</div>
					<div class="inp-item__inp-row inp-item__inp-row_num">
						<div class="inp-item__name inp-item__name_num">Колличество</div>
						<input class="inp-item__input inp-item__input_num" id="door_1-num"
							autocomplete="off" type="number" name="door" data-error="Ошибка"
							data-value="" placeholder="1">
						<div class="inp-item__unit inp-item__unit_num">шт.</div>
					</div>
				</div>
			</div>`);
		}
	}
	if (!addOrDel && sectionItemLength > 2) {
		e.target.parentNode.parentNode.remove();
		let sectionBlockTitle = sectionBody.querySelectorAll('.inp-item__title-num');
		sectionBlockTitle.forEach((elem, index) => {
			elem.innerHTML = index + 1;
		});
	}
}

// Функции END ========================================================


// LocalStorage START ========================================================

if (localStorage.getItem('pageHeaderSave') === 'room') {
	addRoom();
}
if (localStorage.getItem('pageHeaderSave') === 'wall') {
	addWall();
}
if (localStorage.getItem('pageHeaderSave') === 'details') {
	addDetails();
}
if (localStorage.getItem('pageHeaderSave') === 'instruction') {
	addInstruction();
}
// LocalStorage END ========================================================


// События клик START ========================================================
document.addEventListener('click', (e) => {
	// подчеркивание кнопки, открытие секции нужной вкладки
	if (e.target.closest('#room-tab')) {
		addRoom();
		localStorage.setItem('pageHeaderSave', 'room')
	}
	if (e.target.closest('#wall-tab')) {
		addWall();
		localStorage.setItem('pageHeaderSave', 'wall')
	}
	if (e.target.closest('#details-tab')) {
		addDetails();
		localStorage.setItem('pageHeaderSave', 'details')
	}
	if (e.target.closest('#instruction-tab')) {
		addInstruction();
		localStorage.setItem('pageHeaderSave', 'instruction')
	}
	//адаптация инструкции и детали 
	if (e.target.closest('#icon-info-mobile')) {
		let infoMobile = document.querySelector('#info-body-mobile');
		infoMobile.classList.toggle('_active');
	}
	if (!e.target.closest('#icon-info-mobile') && !e.target.closest('#info-body-mobile') && document.querySelector('#info-body-mobile').classList.contains('_active')) {
		let infoMobile = document.querySelector('#info-body-mobile');
		infoMobile.classList.remove('_active');
	}
	//radio-btn
	if (e.target.closest('.radio__inp')) {
		radioDel(e);
		let radioLabel = e.target.nextElementSibling;
		radioLabel.classList.add('_active');
		let inpCustom = e.target.parentNode.parentNode.parentNode.querySelector('.inp-item__input_сustom');
		let inpCustomStock = e.target.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector('.inp-item__input_сustom');
		if (inpCustom) {
			inpCustom.value = "";
		}
		if (inpCustomStock) {
			inpCustomStock.value = "";
		}

	}
	//add BlocksItems комнаты окна  двери стены

	if (e.target.closest('.add-btn')) {
		addOrDelSectionBlock(e, true);
	}
	// del BlocksItems комнаты окна  двери стены
	if (e.target.closest('.inp-item__rotate-del')) {
		addOrDelSectionBlock(e, false);
	}
});

// События клик END ========================================================

// События FOCUSOUT START ========================================================
document.addEventListener('focusout', (e) => {
	if (e.target.closest('#custom_rulon-width')) {
		let inpCustomRulonWidth = document.querySelector('#custom_rulon-width');
		if (inpCustomRulonWidth.value !== '0' && inpCustomRulonWidth.value !== '') {
			radioDel(e);
		}
	}
	if (e.target.closest('#custom_rulon-length')) {
		let inpCustomRulonLength = document.querySelector('#custom_rulon-length');
		if (inpCustomRulonLength.value !== '0' && inpCustomRulonLength.value !== '') {
			radioDel(e);
		}
	}
	if (e.target.closest('#custom_stock')) {
		let inpCustomRulonLength = document.querySelector('#custom_stock');
		if (inpCustomRulonLength.value !== '0' && inpCustomRulonLength.value !== '') {
			let radioBody = e.target.parentNode.parentNode.parentNode.parentNode;
			let allRadio = radioBody.querySelectorAll('.radio__text');
			allRadio.forEach((elem) => {
				if (elem.classList.contains('_active')) {
					elem.classList.remove('_active')
				}
			});
		}
	}
});





